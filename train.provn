document
prefix repr <https://w3id.org/reproduceme#>
prefix cpm <http://commonprovenancemodel.org/ns/cpm/>
prefix conn <http://_PLACEHOLER_:8000/api/v1/connectors/>
prefix bndl <http://_PLACEHOLER_:8000/api/v1/organizations/ORG/graphs/>
prefix def <https://example.org/>
prefix meta <http://_PLACEHOLER_:8000/api/v1/graphs/meta/>
bundle bndl:train
prefix repr <https://w3id.org/reproduceme#>
prefix cpm <http://commonprovenancemodel.org/ns/cpm/>
prefix bndl <http://_PLACEHOLER_:8000/api/v1/organizations/ORG/graphs/>
prefix conn <http://_PLACEHOLER_:8000/api/v1/connectors/>
prefix def <https://example.org/>
prefix meta <http://_PLACEHOLER_:8000/api/v1/graphs/meta/>

entity(def:configFile,[def:path = "conf/config_resolved.yaml" %% xsd:string, def:runID = "6bc00f9abbd0465d865f0c1e1fa7196a" %% xsd:string])
entity(def:logsTrain,[prov:type = 'repr:Log', def:path = "logs/task.log" %% xsd:string, def:runID = "6bc00f9abbd0465d865f0c1e1fa7196a" %% xsd:string, def:data = "[2024-01-16 16:40:56,449][task_cli][INFO] - [Reproducibility] Seeding everything. Seed=289824339. Determinism=False.
[2024-01-17 01:00:27,628][urllib3.connectionpool][WARNING] - Retrying (Retry(total=4, connect=4, read=5, redirect=5, status=5)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5d108d0090>: Failed to establish a new connection: [Errno 111] Connection refused')': /api/2.0/mlflow/runs/log-batch
[2024-01-17 01:03:04,446][urllib3.connectionpool][WARNING] - Retrying (Retry(total=4, connect=4, read=5, redirect=5, status=5)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5c79503610>: Failed to establish a new connection: [Errno 111] Connection refused')': /api/2.0/mlflow/runs/log-batch
[2024-01-17 01:03:08,550][urllib3.connectionpool][WARNING] - Retrying (Retry(total=3, connect=3, read=5, redirect=5, status=5)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5d5a2dc790>: Failed to establish a new connection: [Errno 111] Connection refused')': /api/2.0/mlflow/runs/log-batch
[2024-01-17 01:03:17,106][urllib3.connectionpool][WARNING] - Retrying (Retry(total=2, connect=2, read=5, redirect=5, status=5)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5d5a2df1d0>: Failed to establish a new connection: [Errno 111] Connection refused')': /api/2.0/mlflow/runs/log-batch
[2024-01-17 01:03:33,573][urllib3.connectionpool][WARNING] - Retrying (Retry(total=1, connect=1, read=5, redirect=5, status=5)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f5d307dca90>: Failed to establish a new connection: [Errno 111] Connection refused')': /api/2.0/mlflow/runs/log-batch
" %% xsd:string])
entity(def:configTrain,[def:data = "{\"ml\":{\"_target_\":\"histopipe.ml.HistoPipeModule\",\"net\":{\"features\":{\"_target_\":\"histopipe.ml.nets.VGG16Features\",\"weights\":\"IMAGENET1K_V1\"},\"global_max_pooling\":{\"_target_\":\"histopipe.ml.nets.GMaxPool\"},\"classifier\":{\"_target_\":\"histopipe.ml.nets.BinaryClassifier\"}},\"output_activation\":{\"_target_\":\"torch.nn.Sigmoid\"},\"optimizer\":{\"_target_\":\"torch.optim.Adam\",\"_partial_\":true,\"lr\":5.0E-5,\"weight_decay\":5.0E-5},\"loss\":{\"_target_\":\"torch.nn.BCELoss\",\"reduction\":\"sum\"},\"metrics\":{\"binary_accuracy\":{\"_target_\":\"torchmetrics.classification.BinaryAccuracy\"},\"binary_auroc\":{\"_target_\":\"torchmetrics.classification.BinaryAUROC\"},\"binary_recall\":{\"_target_\":\"torchmetrics.classification.BinaryRecall\"},\"binary_specificity\":{\"_target_\":\"torchmetrics.classification.BinarySpecificity\"}},\"lr_scheduler\":{\"scheduler\":{\"_target_\":\"torch.optim.lr_scheduler.ReduceLROnPlateau\",\"_partial_\":true,\"mode\":\"min\",\"factor\":0.5,\"patience\":3},\"monitor\":\"valid/loss\"}},\"datamodule\":{\"_target_\":\"histopipe.datamodule.WSIDataModule\",\"data_sources\":{\"prostate\":{\"_target_\":\"histopipe.datamodule.datasources.WSIDataSource\",\"seed\":289824339,\"data_uris\":[\"mlflow-artifacts:/4/5b7897d856964f04bd1fefe3e05d0981/artifacts/dataset\",\"mlflow-artifacts:/4/bf58eedba3c24be2ad046ee99b401f6e/artifacts/dataset\",\"mlflow-artifacts:/4/bf25a3c2995545bc91f7936f83c66c7e/artifacts/dataset\",\"mlflow-artifacts:/4/271f5067346048eba64af3ae561863ba/artifacts/dataset\"],\"excl_uris\":null,\"stratified_keys\":[\"is_cancer\"],\"splits\":{\"train\":0.8,\"valid\":0.2}},\"prostate_test\":{\"_target_\":\"histopipe.datamodule.datasources.WSIDataSource\",\"seed\":289824339,\"data_uris\":[\"mlflow-artifacts:/4/42a6acd9b91942b4838646b6e9a2c158/artifacts/dataset\"],\"excl_uris\":null,\"splits\":{\"test\":1.0}}},\"datasets\":{\"train\":{\"_target_\":\"histopipe.datamodule.datasets.ClassificationDataset\",\"sampler\":{\"_target_\":\"histopipe.datamodule.samplers.RandomTreeSampler\",\"seed\":289824339,\"epoch_size\":20000,\"index_levels\":[\"is_cancer\",\"slide_name\"]},\"augmentations\":{\"_target_\":\"albumentations.Compose\",\"p\":1.0,\"transforms\":[{\"_target_\":\"albumentations.RandomRotate90\",\"p\":0.75},{\"_target_\":\"albumentations.Flip\",\"p\":0.5},{\"_target_\":\"albumentations.RandomGamma\",\"p\":0.5},{\"_target_\":\"albumentations.RandomBrightnessContrast\",\"p\":0.5},{\"_target_\":\"albumentations.HueSaturationValue\",\"p\":0.5},{\"_target_\":\"albumentations.Normalize\",\"mean\":0.5,\"std\":0.5,\"max_pixel_value\":255,\"p\":1.0}]},\"seed\":289824339},\"valid\":{\"_target_\":\"histopipe.datamodule.datasets.ClassificationDataset\",\"sampler\":{\"_target_\":\"histopipe.datamodule.samplers.RandomTreeSampler\",\"seed\":289824339,\"epoch_size\":5000,\"index_levels\":[\"is_cancer\",\"slide_name\"]},\"augmentations\":{\"_target_\":\"albumentations.Compose\",\"p\":1.0,\"transforms\":[{\"_target_\":\"albumentations.Normalize\",\"mean\":0.5,\"std\":0.5,\"max_pixel_value\":255,\"p\":1.0}]},\"seed\":289824339}},\"dataloaders_kwargs\":{\"train\":{\"num_workers\":8,\"batch_size\":32},\"valid\":{\"num_workers\":8,\"batch_size\":32}}},\"user\":\"mjakubik\",\"seed\":289824339,\"use_determinism\":false,\"mlflow\":{\"tracking_uri\":\"http://mlflow.rationai-mlflow:5000/\"},\"metadata\":{\"experiment_name\":\"Prostate\",\"run_name\":\"VGG16 retraining\",\"description\":\"Prostate cancer binary classification.\\nThe goal is to retrain VGG16 model on the same data in the new pipeline with analogous performance.\\n\",\"hyperparameters\":{\"max_epochs\":50,\"train_epoch_size\":20000,\"valid_epoch_size\":5000,\"lr\":5.0E-5,\"weight_decay\":5.0E-5,\"batch_size\":32}},\"task\":{\"_target_\":\"histopipe.Task\",\"ml\":{\"_target_\":\"histopipe.ml.HistoPipeModule\",\"net\":{\"features\":{\"_target_\":\"histopipe.ml.nets.VGG16Features\",\"weights\":\"IMAGENET1K_V1\"},\"global_max_pooling\":{\"_target_\":\"histopipe.ml.nets.GMaxPool\"},\"classifier\":{\"_target_\":\"histopipe.ml.nets.BinaryClassifier\"}},\"output_activation\":{\"_target_\":\"torch.nn.Sigmoid\"},\"optimizer\":{\"_target_\":\"torch.optim.Adam\",\"_partial_\":true,\"lr\":5.0E-5,\"weight_decay\":5.0E-5},\"loss\":{\"_target_\":\"torch.nn.BCELoss\",\"reduction\":\"sum\"},\"metrics\":{\"binary_accuracy\":{\"_target_\":\"torchmetrics.classification.BinaryAccuracy\"},\"binary_auroc\":{\"_target_\":\"torchmetrics.classification.BinaryAUROC\"},\"binary_recall\":{\"_target_\":\"torchmetrics.classification.BinaryRecall\"},\"binary_specificity\":{\"_target_\":\"torchmetrics.classification.BinarySpecificity\"}},\"lr_scheduler\":{\"scheduler\":{\"_target_\":\"torch.optim.lr_scheduler.ReduceLROnPlateau\",\"_partial_\":true,\"mode\":\"min\",\"factor\":0.5,\"patience\":3},\"monitor\":\"valid/loss\"}},\"datamodule\":{\"_target_\":\"histopipe.datamodule.WSIDataModule\",\"data_sources\":{\"prostate\":{\"_target_\":\"histopipe.datamodule.datasources.WSIDataSource\",\"seed\":289824339,\"data_uris\":[\"mlflow-artifacts:/4/5b7897d856964f04bd1fefe3e05d0981/artifacts/dataset\",\"mlflow-artifacts:/4/bf58eedba3c24be2ad046ee99b401f6e/artifacts/dataset\",\"mlflow-artifacts:/4/bf25a3c2995545bc91f7936f83c66c7e/artifacts/dataset\",\"mlflow-artifacts:/4/271f5067346048eba64af3ae561863ba/artifacts/dataset\"],\"excl_uris\":null,\"stratified_keys\":[\"is_cancer\"],\"splits\":{\"train\":0.8,\"valid\":0.2}},\"prostate_test\":{\"_target_\":\"histopipe.datamodule.datasources.WSIDataSource\",\"seed\":289824339,\"data_uris\":[\"mlflow-artifacts:/4/42a6acd9b91942b4838646b6e9a2c158/artifacts/dataset\"],\"excl_uris\":null,\"splits\":{\"test\":1.0}}},\"datasets\":{\"train\":{\"_target_\":\"histopipe.datamodule.datasets.ClassificationDataset\",\"sampler\":{\"_target_\":\"histopipe.datamodule.samplers.RandomTreeSampler\",\"seed\":289824339,\"epoch_size\":20000,\"index_levels\":[\"is_cancer\",\"slide_name\"]},\"augmentations\":{\"_target_\":\"albumentations.Compose\",\"p\":1.0,\"transforms\":[{\"_target_\":\"albumentations.RandomRotate90\",\"p\":0.75},{\"_target_\":\"albumentations.Flip\",\"p\":0.5},{\"_target_\":\"albumentations.RandomGamma\",\"p\":0.5},{\"_target_\":\"albumentations.RandomBrightnessContrast\",\"p\":0.5},{\"_target_\":\"albumentations.HueSaturationValue\",\"p\":0.5},{\"_target_\":\"albumentations.Normalize\",\"mean\":0.5,\"std\":0.5,\"max_pixel_value\":255,\"p\":1.0}]},\"seed\":289824339},\"valid\":{\"_target_\":\"histopipe.datamodule.datasets.ClassificationDataset\",\"sampler\":{\"_target_\":\"histopipe.datamodule.samplers.RandomTreeSampler\",\"seed\":289824339,\"epoch_size\":5000,\"index_levels\":[\"is_cancer\",\"slide_name\"]},\"augmentations\":{\"_target_\":\"albumentations.Compose\",\"p\":1.0,\"transforms\":[{\"_target_\":\"albumentations.Normalize\",\"mean\":0.5,\"std\":0.5,\"max_pixel_value\":255,\"p\":1.0}]},\"seed\":289824339}},\"dataloaders_kwargs\":{\"train\":{\"num_workers\":8,\"batch_size\":32},\"valid\":{\"num_workers\":8,\"batch_size\":32}}},\"trainer\":{\"_target_\":\"histopipe.trainer.Trainer\",\"reload_dataloaders_every_n_epochs\":1,\"logger\":{\"_target_\":\"lightning.pytorch.loggers.MLFlowLogger\",\"experiment_name\":\"Prostate\",\"run_name\":\"VGG16 retraining\",\"tracking_uri\":\"http://mlflow.rationai-mlflow:5000/\",\"tags\":{\"mlflow.user\":\"mjakubik\",\"mlflow.note.content\":\"Prostate cancer binary classification.\\nThe goal is to retrain VGG16 model on the same data in the new pipeline with analogous performance.\\n\"},\"log_model\":\"all\"},\"callbacks\":{\"log_best_model\":{\"_target_\":\"histopipe.trainer.callbacks.MLFlowModelCheckpoint\",\"monitor\":\"valid/binary_auroc\",\"save_weights_only\":true,\"mode\":\"max\",\"save_top_k\":1,\"auto_insert_metric_name\":true,\"save_last\":true,\"filename\":\"vgg16_prostate_best\"},\"early_stopping\":{\"_target_\":\"lightning.pytorch.callbacks.EarlyStopping\",\"monitor\":\"valid/binary_auroc\",\"patience\":5,\"mode\":\"max\"},\"lr_monitor\":{\"_target_\":\"lightning.pytorch.callbacks.LearningRateMonitor\",\"logging_interval\":\"epoch\"}},\"max_epochs\":50,\"log_every_n_steps\":20},\"hyperparameters\":{\"max_epochs\":50,\"train_epoch_size\":20000,\"valid_epoch_size\":5000,\"lr\":5.0E-5,\"weight_decay\":5.0E-5,\"batch_size\":32},\"stage\":\"???\"},\"trainer\":{\"_target_\":\"histopipe.trainer.Trainer\",\"reload_dataloaders_every_n_epochs\":1,\"logger\":{\"_target_\":\"lightning.pytorch.loggers.MLFlowLogger\",\"experiment_name\":\"Prostate\",\"run_name\":\"VGG16 retraining\",\"tracking_uri\":\"http://mlflow.rationai-mlflow:5000/\",\"tags\":{\"mlflow.user\":\"mjakubik\",\"mlflow.note.content\":\"Prostate cancer binary classification.\\nThe goal is to retrain VGG16 model on the same data in the new pipeline with analogous performance.\\n\"},\"log_model\":\"all\"},\"callbacks\":{\"log_best_model\":{\"_target_\":\"histopipe.trainer.callbacks.MLFlowModelCheckpoint\",\"monitor\":\"valid/binary_auroc\",\"save_weights_only\":true,\"mode\":\"max\",\"save_top_k\":1,\"auto_insert_metric_name\":true,\"save_last\":true,\"filename\":\"vgg16_prostate_best\"},\"early_stopping\":{\"_target_\":\"lightning.pytorch.callbacks.EarlyStopping\",\"monitor\":\"valid/binary_auroc\",\"patience\":5,\"mode\":\"max\"},\"lr_monitor\":{\"_target_\":\"lightning.pytorch.callbacks.LearningRateMonitor\",\"logging_interval\":\"epoch\"}},\"max_epochs\":50,\"log_every_n_steps\":20}}" %% xsd:string])
entity(conn:trainTrainingTilesConnector,[prov:type = 'cpm:backwardConnector', cpm:receiverBundleId = 'bndl:preprocTrain'])
entity(def:trainingTilesDataset,[prov:type = 'repr:Dataset'])
entity(conn:trainedModelConnector,[prov:type = 'cpm:forwardConnector', cpm:senderBundleId = 'bndl:eval'])
entity(def:trainedModel,[prov:type = 'repr:Model', def:path = "model/" %% xsd:string, def:runID = "6bc00f9abbd0465d865f0c1e1fa7196a" %% xsd:string])
activity(def:training,-,-,[prov:type = 'cpm:mainActivity', repr:hasPart = 'def:prostateTrain', cpm:metabundle = 'meta:trainMeta'])
activity(def:prostateTrain,-,-)
agent(def:researchDataCentre,[prov:type = 'cpm:senderAgent'])
used(def:training,conn:trainTrainingTilesConnector,-)
used(def:prostateTrain,def:trainingTilesDataset,-)
used(def:prostateTrain,def:configTrain,-)
wasGeneratedBy(conn:trainedModelConnector,def:training,-)
wasGeneratedBy(def:logsTrain,def:prostateTrain,-)
wasGeneratedBy(def:trainedModel,def:prostateTrain,-)
wasDerivedFrom(conn:trainedModelConnector, conn:trainTrainingTilesConnector)
wasDerivedFrom(def:configTrain, def:configFile)
wasDerivedFrom(def:trainedModel, def:trainingTilesDataset)
wasDerivedFrom(def:trainedModel, def:configTrain)
wasAttributedTo(conn:trainTrainingTilesConnector, def:researchDataCentre)
specializationOf(def:trainingTilesDataset,conn:trainTrainingTilesConnector)
specializationOf(def:trainedModel,conn:trainedModelConnector)
endBundle
endDocument
